# 성능 테스트 설계 오류로 인한 부하 한계치 오판 이슈

---

## 1. 문제 상황

초기 성능 테스트에서 서비스의 **최대 부하를 1000 사용자로 가정**하고 부하 테스트 시작.

테스트 결과, 해당 부하 구간에서 실패가 발생했고 이후 다음과 같은 방식으로 내려가며 테스트 진행.

- 1000 → 800 → 600 → 400 → 200 순으로 사용자 수를 감소
- 200 사용자 구간에서 지표가 안정적으로 보이는 것을 확인
- 200 사용자를 **안정 구간(Stable)** 으로 판단

그러나 이후 피드백을 통해 이와 같은 접근 방식 자체에 구조적인 문제가 있음을 인지.

---

## 2. 문제 인식 및 피드백

초기 성능 테스트 결과에 대해 다음과 같은 피드백을 받음.

- 최대 부하(1000 사용자)를 **근거 없이 임의로 설정**
- 이미 과도한 부하를 가한 상태에서 연속 테스트 수행
- 시스템이 완전히 회복되지 않은 상태에서 결과를 해석했을 가능성
- 그 결과, **실제 서비스 한계보다 과도하게 낮은 수치를 안정 구간으로 오판했을 가능성**

특히 피드백의 핵심은 다음과 같은 관점임.

> “한계치는 위에서 내려오는 방식이 아니라  
> 아래에서부터 점진적으로 올리면서 확인해야 한다.  
> 이미 강한 부하를 가하면 시스템이 끊긴 상태일 수 있다.”

이 피드백을 통해 초기 테스트 실패가 **순수한 성능 한계가 아닐 수 있음**을 인지.

---

## 3. 문제 발생 조건 분석

초기 테스트 방식에는 다음과 같은 문제 요인이 동시에 작용했을 가능성 존재.

- 인증(OAuth) 기반 구조에서 세션/토큰 처리 부하
- 커넥션 풀 고갈 가능성
- 리소스 회복 이전 상태에서 다음 테스트가 연속 수행됨
- 보안 정책이 특정 부하 패턴을 비정상 트래픽으로 인식했을 가능성

이로 인해 실제 성능 한계보다 **더 이른 시점에서 실패가 관측되었을 가능성**이 높다고 판단.

---

## 4. 테스트 전략 재설계

### 4.1 접근 방식 전환

최대 부하치를 올바르게 측정하기 위해 다음과 같이 테스트 접근 방식을 재설계.

- 사용자 수를 **낮은 구간에서부터 점진적으로 증가**
- 200 사용자부터 시작하여 **50 단위로 증가**
- ramp-up 시간을 주요 변수로 두고 부하 인가 방식 조정
- 부하 테스트와 스파이크 테스트를 분리하여 해석

---

### 4.2 재설계 후 관측 과정

#### 1) 점진적 부하 증가 테스트

- 200 → 250 → 300 … 순으로 증가
- 기존에 사용하던 `200 / 30 / 10` 과 비교하여  
  `1000 / 30 / 10` 구간에서도 **유의미한 지표 변화가 관측되지 않음**

#### 2) ramp-up 증가 시점에서의 변화

- `1000 / 30 / 20`부터 지표 흔들림 발생
- `1000 / 30 / 30`에서 중간에 **403 응답 발생**
- 이후 `900 / 30 / 30`으로 낮추자 품질은 저하되지만 다시 정상 동작

이를 통해 403 오류가 **순수한 서버 성능 문제가 아니라 OAuth 기반 인증 구조에서 감당 가능한 한계를 초과했을 가능성**으로 판단.

---

### 4.3 스파이크 테스트를 통한 검증

- `800 / 0 / 1` 스파이크 테스트 시도
- 동일하게 **403 응답 발생**
- ramp-up을 늘려 `800 / 10 / 1`로 재시도 → 정상 동작 확인

이를 통해 다음과 같은 결론에 도달.

- 짧은 ramp-up(30초 이하)에서 다수의 요청이 동시에 유입될 경우
- OAuth 기반 인증 구조에서 이를 **봇 또는 비정상 트래픽으로 오인**
- 그 결과 403 오류 발생

즉, 초기 테스트에서 발생한 실패는 **성능 한계 + 잘못된 부하 인가 방식 + 보안 정책 영향**이 복합적으로 작용한 결과.

---

## 5. 성능 한계 구간 재정의

ramp-up을 40초로 늘린 뒤 다음과 같은 부하 구간을 단계적으로 관측.

- `1000 / 40 / 30` : 품질 저하는 있으나 정상 동작
- `1100 / 40 / 30` : 처리량 상한(ceiling) 도달
- `1200 / 40 / 30` : 처리량 하락 시작, 일부 500 오류 발생
- `1300 / 40 / 30` : 연결 실패 및 다수 500 오류 발생 (완전 붕괴)


<table align="center">
  <tr>
    <td align="center">
      <img src="portfolio-yoonyoung/assets/images/performance_1000_40_30.png" width="300">
      <br>
      <sub>1000_40_30_TPS</sub>
    </td>
    <td align="center">
      <img src="portfolio-yoonyoung/assets/images/performance_1100_40_30.png" width="300">
      <br>
      <sub>1100_40_30_TPS</sub>
    </td>
  </tr>
  <tr>
    <td align="center">
      <img src="portfolio-yoonyoung/assets/images/performance_1200_40_30.png" width="300">
      <br>
      <sub>1200_40_30_TPS</sub>
    </td>
    <td align="center">
      <img src="portfolio-yoonyoung/assets/images/performance_1300_40_30.png" width="300">
      <br>
      <sub>1300_40_30_TPS</sub>
    </td>
  </tr>
</table>


이를 통해 기존에 안정 구간으로 판단했던 **200 사용자 기준이 과도하게 보수적인 값**이었음을 확인.

---

## 6. 최종 성능 구간 정의

### 성능 테스트 (부하 수준 기반 품질 판단)

| 부하 구간 | 주요 결과 | 판단 결과 |
|---------|----------|----------|
| **Stable (800 / 30 / 10)** | Avg / P95 / Error Rate 기준 충족 | 정상 운영 가능 |
| **Upper (1100 / 40 / 30)** | 일부 지표 SLA 미충족 | 한계 상한선 |
| **Stress (1300 / 40 / 30)** | 다수 요청 실패 및 SLA 초과 | 운영 불가 |

---

## ✅ 최종 정리

- 성능 테스트에서는 **최대 부하치 탐색을 선행**한 후 해당 기준에 따라 평가 지표와 기준을 설정해야 함.
- ramp-up은 단순한 옵션이 아니라 **성능 결과와 보안 정책에 직접적인 영향을 미치는 핵심 설계 요소**.
- 인증 및 트래픽 정책은 순수한 성능 한계 이전에 **실질적인 상한선으로 작동할 수 있음.**
- 부하 테스트 결과는 반드시 **부하 인가 방식과 시스템 회복 상태를 함께 고려하여 해석해야 함.**

이번 경험을 통해 성능 테스트는 단순히 수치를 측정하는 작업이 아니라 **시스템이 어떤 조건에서 어떻게 반응하는지를 해석하는 과정**임을 명확히 인식.
